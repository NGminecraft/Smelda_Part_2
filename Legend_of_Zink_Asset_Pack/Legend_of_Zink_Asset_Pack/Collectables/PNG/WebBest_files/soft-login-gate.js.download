define(["version!fly/managers/debug","utils/get-popup-window"],function(e,t){function o(t,o){this.debug=e.init("soft-login-gate"),this.element=t,this.options=o,this.deviceName=null,this.isHidden=null,this.updateURL=o.url,document.querySelector(".soft-login-gate__form--submit").addEventListener("click",async()=>{this.onSubmit()}),this.show()}return o.prototype.show=function(){this.intersectionObserver=new IntersectionObserver(function(e){e[0].isIntersecting&&(document.querySelector("#soft-login-gate").classList.add("soft-login-gate__show"),document.querySelector("body").style.marginBottom="200px",CBSNEWS.tracking.queue.push({type:"link",data:{_clickAction:"softLoginGateDisplay",link_text:"trackSoftLoginGateDisplay"}}))},{threshold:.125}),this.intersectionObserver.observe(document.querySelector(".content__body"))},o.prototype.onSubmit=async function(){var e=document.querySelector(".soft-login-gate__form--input"),o=document.querySelector(".soft-login-gate__form--error-empty"),n=document.querySelector(".soft-login-gate__form--error-invalid");if(""==e.value)n.style.display="none",o.style.display="inline";else if(1==e.validity.typeMismatch)o.style.display="none",n.style.display="inline";else if(1==e.validity.valid){o.style.display="none",n.style.display="none";const e=document.querySelector(".soft-login-gate__form");try{const o=new FormData(e),n=Object.fromEntries(o.entries()),s=new URLSearchParams;s.append("email",n.email);var i=t("about:blank");await fetch(this.updateURL,{credentials:"same-origin",method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"},body:s}).then(async e=>{window.localStorage.setItem("user_email_frictionless",n.email);const t=await e.json();if("success"==t.status){const e=document.querySelector("#anchor-signup");i.location.replace(e.href)}else if("failure"==t.status){const e=document.querySelector("#anchor-login");i.location.replace(e.href)}})}catch(e){console.error(e)}}},function(e,t){new o(e,t)}});