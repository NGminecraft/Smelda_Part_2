define(["version!fly/managers/debug","utils/get-cookie"],function(e,t){function o(o,s){this.debug=e.init("login-gate-cookie"),this.element=o,this.options=s,this.debug.log("init",o,"with options",s),this.countryCode=null,this.geoCookie=t("fly_geo"),void 0!==this.geoCookie?(this.countryCode=JSON.parse(this.geoCookie).countryCode.toLowerCase(),"us"===this.countryCode.toLowerCase()&&(CBSNEWS.features.isFeatureEnabled("soft-login-gate")?this.visitedYesterday():this.debug.log("Disabled by FeatureFlag"))):this.debug.log("no geo cookie")}return o.prototype.visitedYesterday=function(){var e=CBSNEWS.features.getFeatureValue("login-gate"),t=new Date;t.setHours(0,0,0,0);var o=new Date(t);if(o.setDate(o.getDate()+1),!CBSNEWS.isPreviewRequest)if(e){this.debug.log("cookie found",e);let s,i=new Date(e.showNext);e.showNow&&(s=new Date(e.showNow)),i-t==0?(this.debug.log("showing gate"),e.showNow=t,e.showNext=o,CBSNEWS.features.setFeatureValue("login-gate",e,{type:"permanent"}),document.documentElement.classList.add("visited-yesterday")):s-t==0?(this.debug.log("showing for nth time"),document.documentElement.classList.add("visited-yesterday")):(this.debug.log("setting date to tomorrow",e),e.showNext=o,CBSNEWS.features.setFeatureValue("login-gate",e,{type:"permanent"}))}else{this.debug.log("no cookie, start fresh");var s={};s.showNext=o,s.showNow=!1,CBSNEWS.features.setFeatureValue("login-gate",s,{type:"permanent"})}},function(e,t){new o(e,t)}});